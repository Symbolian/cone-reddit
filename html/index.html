<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Cone for Reddit</title>

    <!-- Bootstrap -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" type="text/css" href="css/main.css" />

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body id="body_pres">

    <div class="container">
        <!-- Main content -->
        <section class="row main-display">
            <!--  Should not be visible-->
            <div class='wrapper'>
              <canvas hidden id="textureCanvas" width="256" height="64" style="border: 1px solid black" >
                Your browser doesn't appear to support the HTML5.</canvas>
            </div>

            <div class='col-xs-5' id='div_canvas'>
                <div class="canvas-wrapper">
                    <canvas id="glcanvas" width="666" height="1000"  tabindex="1">
                        Your browser doesn't appear to support the HTML5 <code>&lt;canvas&gt;</code> element.</canvas>
                </div>
            </div>

            <div class='col-xs-7 democontent-wrapper'>
                <div class="title">
                    <h1>Cone for Reddit</h1>
                    <p class="lead">An interative 3D visualization of Reddit comments</p>
                </div>
                <div id="democontent">
                    <!-- Home -->
                    <p class="tutorial">
                        <span class="label label-default">
                            <span class="glyphicon glyphicon-arrow-left" aria-hidden="true"></span>
                        </span>
                        &nbsp;
                        <span class="label label-default">
                            <span class="glyphicon glyphicon-arrow-right" aria-hidden="true"></span>
                        </span>
                        &nbsp;
                        <strong>Turn the view</strong> with your left and right arrow keys.
                    <br />
                        <span class="label label-default">
                            <span class="glyphicon glyphicon-arrow-up" aria-hidden="true"></span>
                        </span>
                        &nbsp;
                        <span class="label label-default">
                            <span class="glyphicon glyphicon-arrow-down" aria-hidden="true"></span>
                        </span>
                        &nbsp;
                        <strong>Zoom into the view</strong> using your up and down arrow keys.
                    <br />
                        <span class="label label-default">
                            <span class="glyphicon glyphicon-hand-up" aria-hidden="true"></span>
                        </span>
                        &nbsp;
                        You can also use your mouse to click entries you want to navigate to.
                    </p>

                    <div id="overview">
                        <p>We have chosen to include our own selection of subreddits that we think are interesting to browse:</p>

                        <ul class="subreddit_list">
                            <li class="bg-primary"><strong>AskReddit</strong>:
                                <span>Questions that elicit thought-provoking discussions, as well as some lighter questions which will hopefully entertain.</span>
                            </li>
                            <li><strong>AskHistorians</strong>:
                                <span>Serious, academic-level answers to questions about history.</span>
                            </li>
                            <li><strong>AskScience</strong>:
                                <span>A forum for science questions and scientific answers.</span>
                            </li>
                            <li><strong>DataIsBeautiful</strong>:
                                <span>Data visualizations of all kinds.</span>
                            </li>
                            <li><strong>LifeProTips</strong>:
                                <span>Tips that improve your life in a meaningful way.</span>
                            </li>
                            <li><strong>TrueReddit</strong>:
                                <span>A subreddit for really great, insightful articles and intelligent discussion.</span>
                            </li>
                            <li><strong>FoodForThought</strong>:
                                <span>Intelligent and thought-provoking commentaries on life and culture.</span>
                            </li>
                            <li><strong>IamA</strong>:
                                <span>Interviews with interesting people that can be asked <em>anything</em> by the Reddit community.</span>
                            </li>
                            <li><strong>InterestingAsFuck</strong>:
                                <span>A place to share (almost) anything and everything interesting.</span>
                            </li>
                        </ul>
                    </div>

                    <!-- Post -->
                    <div class="post_content">
                        <h1 class="text_post">
                            <span class="title">George RR Martin: Game of Thrones characters die because 'it has to be done' - The Song of Ice and Fire writer has told an interviewer it’s dishonest not to show how war kills heroes as easily as minor characters</span>
                        </h1>
                        <h1 class="link_post">
                            <a class="source" href="" target="_blank"><span class="title">George RR Martin: Game of Thrones characters die because 'it has to be done' - The Song of Ice and Fire writer has told an interviewer it’s dishonest not to show how war kills heroes as easily as minor characters</span></a>
                            <small class="domain">(theguardian.com)</small>
                        </h1>
                        <p class="content">Actual text content</p>
                        <img class="img_content img-responsive" class="img-responsive" src=""/>
                        <div class="movie_content"></div>
                        <p><span class="score">32</span> points – <a class="permalink" href="localhost:" target="_blank">submitted by <span class="author">me</span></a></p>
                    </div>

                    <!-- Comments -->
                    <div class="comment_content">
                        <p>
                            <span class="content">George RR Martin: Game of Thrones characters die because 'it has to be done' - The Song of Ice and Fire writer has told an interviewer it’s dishonest not to show how war kills heroes as easily as minor characters</span>
                        </p>
                        <p class="small"><span class="score">32</span> points – <a class="reddit_link" href="localhost:">submitted by <span class="author">me</span></a></p>
                    </div>
                </div>
            </div>
            <div class="shape_deco">
                <img src="shape.png" />
            </div>
        </section>


        <!-- About section -->
        <section class="row" id="about">
            <div class="col-sm-12">
                <h2>About this project</h2>
            </div>
            <div class="col-sm-4">
                <h3>Who made this?</h3>
                <p><a href="http://symbolian.net/">Symbolian</a> is a company from Berlin that builds tools for knowledge management. This app is a showcase for ConeCanvas, a 3D visualization and ordering-tool for any kind of hierarchical data that we developed.</p>
                <p>While the data from Reddit in this example is static, <a href="http://symbolian.net/product/">ConeCanvas</a> can also be used to edit and re-order datasets. </p>
            </div>
            <div class="col-sm-4">
                <h3>How did you do it?</h3>
                <p>Post and comment data is loaded into ConeCanvas from the <a href="https://www.reddit.com/dev/api">Reddit API</a> using the <a href="https://hackage.haskell.org/package/reddit-0.2.0.0">Haskell reddit package</a>. ConeCanvas renders the cone tree using Symbolian's <a href="https://github.com/jutaro/purescript-webgl"> Purescript bindings for WebGL</a>.</p>
            </div>
            <div class="col-sm-4">
                <h3>Contact</h3>
                <p>Feel free to get in contact if you are interested in using ConeCanvas yourself.</p>
                <p>
                <address>
                  <strong>Symbolian GmbH</strong><br>
                  <a href="mailto:info@symbolian.net">info@symbolian.net</a>
                </address>
                </p>
                <p>Please see the
                <a href="http://symbolian.net/privacy/">privacy policy</a> and
                <a href="http://symbolian.net/terms-and-conditions/">terms and conditions</a>
                for using this website.</p>
            </div>
        </section>


        <!-- About section -->
        <section class="row" id="footer">
            <div class="col-sm-4 col-sm-push-4">
                <img src="symbolian_logo.png" class="img-responsive" alt="Symbolian Logo">
            </div>
        </section>
    </div>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>

    <script type="text/javascript" src="/html/js/Main.js"></script>
    <script type="text/javascript">
            // global variables, accessible from PS module
            var gl;
            var globDivCanvas;
            var coneAPI;
            var tutorial_counter = 5;

            var globCanvasHide = function() {
                if (! globDivCanvas.is(":hidden")) {
                    globDivCanvas.slideUp();
                }
            };
            var globCanvasExpose = function () {
                if (globDivCanvas.is(":hidden")) {
                    globDivCanvas.show("slow");
                }
            };
            var globSetURL = function (newUrl) {
                console.log("globSetURL: " + newUrl)
                if (newUrl)
                    $("#democontent").attr("src", newUrl);
            };

            // Hide the tutorial after five movements outside the top layer
            function cond_hide_tutorial() {
                if (tutorial_counter == 0) {
                    $(".tutorial").fadeOut();
                } else {
                    tutorial_counter = tutorial_counter - 1;
                }
            }

            // Transform escaped html returned by reddit api into dom nodes
            function weird_double_parser(content) {
                var new_content_esc = $.parseHTML(content);
                if (new_content_esc.length > 0) {
                    var new_content = $.parseHTML(new_content_esc[0].data);
                } else {
                    var new_content = new_content_esc;
                }
                return new_content;
            }

            // Show post in sidebar when selected in ConeCanvas
            function show_post(score, title, data) {
                console.log("Selected post '" + title + "' ("+data+")");

                cond_hide_tutorial();

                var contents = data.split('@@');
                var author = contents[1];
                var permalink = contents[2];
                var url = contents[3];
                var body = contents[4];

                // Show appropriate containers
                $("#overview").slideUp(function() {
                    $(".comment_content").fadeOut(function() {
                        $(".post_content").fadeIn();
                    });
                });
                $(".img_content").hide();
                $(".movie_content").hide();

                if (url != "") {
                    // Extract domain from URL
                    if (url.indexOf("://") > -1) { domain = url.split('/')[2]; }
                    else { domain = url.split('/')[0]; }

                    // Show appropriate containers
                    $(".post_content .text_post").hide();
                    $(".post_content .link_post").show();
                    $(".post_content .content").hide();

                    // Setup link for URL
                    $(".post_content .source").attr('href', url);
                    $(".post_content .domain").html(domain);

                    // Conditional show image
                    var short_ending = url.substr(-3).toLowerCase();
                    var long_ending = url.substr(-4).toLowerCase();

                    if ($.inArray(short_ending, ["jpg", "png", "gif"]) >= 0 || long_ending == "jpeg") {
                        $(".img_content").show();
                        $(".img_content").attr("src", url);
                    } else if (long_ending == "gifv") {
                        var webmsource = url.slice(0,-4) + "webm";
                        var mp4source = url.slice(0,-4) + "mp4";
                        $(".movie_content").html("<video class='img-responsive' autoplay='' loop='' muted='' preload=''><source src='"+webmsource+"' type='video/webm'><source src='"+mp4source+"' type='video/mp4'></video>");
                        $(".movie_content").show();
                    }

                } else {
                    // Text post appropriate containers
                    $(".post_content .text_post").show();
                    $(".post_content .link_post").hide();

                    // Show text content if available
                    if (body != "") {
                        $(".post_content .content").show();
                        $(".post_content .content").html("");
                        $(".post_content .content").append(
                            weird_double_parser(body));
                    } else {
                        $(".post_content .content").hide();
                    }
                }

                // Show title and metadata for link
                $(".post_content .title").html(title);
                $(".post_content .score").html(score);
                $(".post_content .permalink").attr('href', permalink);
                $(".post_content .author").html(author);
            }

            // Show comment beneath post when selected in ConeCanvas
            function show_comment(score, author, content) {
                console.log("Selected comment '" + content.substr(0,10) + "...'");

                cond_hide_tutorial();

                $("#overview").slideUp(function() {

                        $(".post_content .content").slideUp(function() {
                            $(".comment_content").fadeIn();
                        });

                });

                $(".comment_content .score").html(score);
                $(".comment_content .author").html(author);



                $(".comment_content .content").html("");
                $(".comment_content .content").append(
                    weird_double_parser(content));

            }

            // Highlight subreddits selected in ConeCanvas
            function show_subreddit(name) {
                console.log("Selected subreddit '"+name+"'");

                $(".post_content").fadeOut(function() {
                    $(".comment_content").fadeOut(function() {
                        $("#overview").slideDown();
                    });
                });

                $(".subreddit_list li").removeClass("bg-primary");
                $(".subreddit_list strong:contains('"+name+"')")
                    .parent().addClass("bg-primary");
            }

            // Entry point which is called when selection in ConeCanvas changes
            var globSelectedPrim = function (entry) {
                if (entry.comment.value0[0]=="p") {
                    show_post(entry.targetUri.value0, entry.label,
                        entry.comment.value0.slice(1));
                } else if (entry.comment.value0[0]=="n") {
                    show_subreddit(entry.label);
                } else if (entry.comment.value0[0]=="c") {
                    show_comment(entry.targetUri.value0, entry.label,
                        entry.comment.value0.slice(1));
                } else {
                    alert("Data error. Please reload page");
                }
            };

            window.onload = function() {
            // $( document ).ready(function() {
                globDivCanvas = $('#div_canvas');

                // blur the iframe
                document.getElementById("democontent").blur();
                // set focus on #glcanvas
                document.getElementById("glcanvas").focus();
                // when iframe tries to focus, focus #glcanvas
                document.getElementById("glcanvas").onblur = function() {
                    this.focus();
                };

                var continuation = function (api){
                    return function () {
                        coneAPI = api;
                    };
                };
                PS["Main"].main(continuation)();
            };
    </script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="js/bootstrap.min.js"></script>
  </body>
</html>
